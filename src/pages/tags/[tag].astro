---
import Layout from "@/layouts/Layout.astro";
import PostLink from "@/components/PostLink.astro";

// export async function getStaticPaths() {
//   const allPosts = await Astro.glob("/src/pages/posts/**/*.md");

//   const uniqueTags = [
//     ...new Set(allPosts.map((post) => post.frontmatter.tags).flat()),
//   ];

//   return uniqueTags.map((tag) => {
//     const filteredPosts = allPosts.filter((post) =>
//       post.frontmatter.tags?.includes(tag)
//     );
//     return {
//       params: { tag },
//       props: { posts: filteredPosts },
//     };
//   });
// }

const { tag } = Astro.params;

const allPosts = await Astro.glob("/src/pages/posts/**/*.md");
const filteredPosts = allPosts.filter((post) =>
  post.frontmatter.tags?.includes(tag)
);
const pageTitle = `CategorÃ­a: ${tag}`;
---

<Layout pageTitle={pageTitle} pageDescription={pageTitle}>
  <p>Entradas etiquetadas con {tag}</p>
  <ul>
    {
      filteredPosts.map((post) => (
        <PostLink url={post.url} title={post.frontmatter.title} />
      ))
    }
  </ul>
</Layout>
